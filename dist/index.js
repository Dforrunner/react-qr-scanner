"use strict";var e=require("react"),t=require("jsqr");function i(){return new Error({name:"NoVideoInputDevicesError",message:"No video input devices found"})}function o(e,t,i){return e.length>0?e[0].deviceId:1===t.length||"user"===i?t[0].deviceId:t[1].deviceId}exports.QrScanner=({onError:n=(e=>console.log({error:e})),onScan:r=(e=>console.log({value:e})),facingMode:a="environment",constraints:s=null,onLoad:c=(()=>null),flipHorizontally:d=!1,style:l,className:v,showViewFinder:u=!0,delay:m=800,resolution:g=1080,aspectRatio:h="16:9",viewFinder:f={border:"12px solid rgba(255,255,255,0.3)",position:"absolute",borderRadius:"5px",width:"250px",height:"250px"}})=>{const p={};let w,b;const y=()=>{const e=/firefox/i.test(navigator.userAgent);let t={};navigator.mediaDevices&&"function"==typeof navigator.mediaDevices.getSupportedConstraints&&(t=navigator.mediaDevices.getSupportedConstraints());const r={};t.facingMode&&(r.facingMode={ideal:a}),t.frameRate&&(r.frameRate={ideal:25,min:10});const c=t.facingMode||e?Promise.resolve(s||r):function(e,t=o){return new Promise(((o,n)=>{let r;try{r=navigator.mediaDevices.enumerateDevices()}catch(e){n(new i)}r.then((r=>{const a=r.filter((e=>"videoinput"===e.kind));if(a.length<1)return void n(new i);const s=function(e){return"environment"===e?/rear|back|environment/gi:/front|user|face/gi}(e),c=a.filter((({label:e})=>s.test(e)));o(t(c,a,e))}))}))}(a).then((e=>Object.assign({},{deviceId:e},s)));c.then((e=>navigator.mediaDevices.getUserMedia({video:e}))).then(E).catch(n)},E=e=>{const{preview:t}=p;if(!t)return setTimeout((()=>E(e)),200);void 0!==(t||{}).srcObject?t.srcObject=e:void 0!==t.mozSrcObject?t.mozSrcObject=e:window.URL.createObjectURL?t.src=window.URL.createObjectURL(e):window.webkitURL?t.src=window.webkitURL.createObjectURL(e):t.src=e,t.playsInline=!0;const i=e.getTracks()[0];b=i.stop.bind(i),t.addEventListener("loadstart",(()=>R(t,i.label)))},R=(e,t)=>{e.play().then((()=>{c({mirrorVideo:"environment"===a,streamLabel:t}),w=setTimeout(j,m)})).catch((()=>{})),e.removeEventListener("loadstart",R)},j=()=>{const{preview:e,canvas:i}=p;if(!e)return setTimeout(j,m);let o=Math.floor(e.videoWidth),n=Math.floor(e.videoHeight),a=0,s=0;const c=g/(o<n?o:n);n*=c,o*=c,s=(n-g)/2*-1,a=(o-g)/2*-1,i.width=g,i.height=g;if(e&&e.readyState===e.HAVE_ENOUGH_DATA){const c=i.getContext("2d",{willReadFrequently:!0}),d=()=>{c.drawImage(e,a,s,o,n);(e=>new Promise((i=>{const o=t(e.data,e.width,e.height);o?i(o.data):i()})))(c.getImageData(0,0,i.width,i.height)).then((e=>{w=setTimeout(d,m),e&&r(e)}))};d()}else w=setTimeout(j,m)},L=e=>t=>p[e]=t;e.useEffect((()=>(y(),()=>{w&&clearTimeout(w),b&&b()})));const D={top:0,left:0,right:0,bottom:0,margin:"auto"},I={...D,width:"100%",height:"100%",display:"block",position:"absolute",overflow:"hidden",objectFit:"cover",transform:d?"scaleX(1)":"scaleX(-1)"},O={...D,...f,zIndex:10,position:"absolute"},[U,x]=h.split(":"),T={width:"100%",paddingBottom:`${x/U*100}%`,display:"block",overflow:"hidden",position:"relative",objectFit:"cover"};return e.createElement("div",{className:v,style:l},e.createElement("div",{style:T},u?e.createElement("div",{style:O}):null,e.createElement("video",{style:I,ref:L("preview")}),e.createElement("canvas",{style:{display:"none"},ref:L("canvas")})))};
